!function(){"use strict";angular.module("storelitedb",[]).run(["$rootScope",function(e){}])}(),angular.module("storelitedb").constant("DBConfig",{showLogs:!0,storageType:"sqlite",dbName:"custom.db",dbSize:5242880,enableMigrations:!1}),angular.module("storelitedb").service("Database",["$q","DBConfig","DBUtil","Log","Loading",function(e,n,t,o,r){var i=null,a=this,s="",u=[],l=n;this.query=function(n,t){return t=t||[],e(function(e,r){i.transaction(function(i){i.executeSql(n,t,function(r,i){return o.success("Query: "+n,[i,t],l.showLogs),e(i)},function(e,i){window.cordova&&window.plugins.toast.show("The query had an error","long","top"),o.DBException(i,n,t,l.showLogs),r(i)})})})},this.setConnectionOptions=function(e){l=angular.extend(n,e||{})},this.connect=function(){return null==i?window.sqlitePlugin?(i=window.sqlitePlugin.openDatabase({name:l.dbName,location:"default"}),o.info("sqlite.connection",i,l.showLogs)):(i=window.openDatabase(l.dbName,"1.0","Test Web SQL Database",l.dbSize),o.info("WebSql.connection",i,l.showLogs)):o.info("cache.connection",i,l.showLogs),this},this.initialize=function(n){var t=[n],r=e.defer();if(null==i){o.info("connect.db",void 0,l.showLogs);var s=this.connect(),u="SELECT sql FROM sqlite_master WHERE tbl_name = '{tableName}' AND type = 'table'";u=u.replace("{tableName}",n.tableName),a.query(u).then(function(i){if(0==i.rows.length){o.info("creating.db",n,l.showLogs),l.enableMigrations&&t.push({tableName:"migrations",columns:{id:"INTEGER PRIMARY KEY AUTOINCREMENT",path:"TEXT NOT NULL",status:"INT NOT NULL",created:"INT NOT NULL"}});var a=[];return angular.forEach(t,function(e,n){a.push(s.create(e.tableName,e.columns))}),e.all(a).then(function(){return r.resolve(s)},function(e){return e=null==e||"length"in e?e:[e],angular.forEach(e,function(e,r){o.DBException(e,n,t,l.showLog)}),r.reject("Cannot was possible run the query")})}return o.info("loading.db",n,l.showLogs),r.resolve(s)},function(e){o.DBException(e,u),r.reject(e)})}else o.info("cached.db"),r.resolve(i);return r.promise},this.create=function(e,n,o){o=angular.isUndefined(o)?"IF NOT EXISTS":"";var r=t.prepareFields(n,"create"),i="CREATE TABLE {notExist} {tableName} ({fields});".replace("{tableName}",e).replace("{notExist}",o).replace("{fields}",r.field);return a.query(i,[])},this.drop=function(e,n){return n=angular.isUndefined(n)?"IF EXISTS ":"",a.query("DROP TABLE "+n+e,[])},this.insert=function(e,n){var o=t.prepareFields(n,"insert"),r="INSERT INTO {tableName} ({fields}) values({values})";return r=r.replace("{tableName}",e).replace("{fields}",o.field.join(",")).replace("{values}",o.field.map(function(e){return"?"})),a.query(r,o.values)},this.update=function(e,n,o){var r=t.prepareFields(n,"update"),i=t.prepareConditions(o),s="UPDATE {tableName} SET {fields} WHERE {condition};";return s=s.replace("{tableName}",e).replace("{fields}",r.field.join(",")).replace("{condition}",i.rules.join(" AND ")),a.query(s,r.values.concat(i.values))},this.remove=function(e,n){var o=t.prepareConditions(n),r="DELETE FROM "+e;return angular.isDefined(n)&&(r+=" WHERE "+o.rules.join(" AND ")+";"),a.query(r,o.values)},this.select=function(e){return s="SELECT "+e.join(", "),this},this.from=function(e){return s+=" FROM "+e,this},this.where=function(e){var n=t.prepareConditions(e);return s+=" WHERE "+n.rules.join(" AND "),u=n.values,this},this.all=function(){return e(function(e,n){if(""==s)return n("no query found");a.query(s,u).then(function(n){s=null,u=[];for(var t=[],o=0;o<n.rows.length;o++)t.push(n.rows.item(o));e(t)},function(e){n(e)})})},this.one=function(){return e(function(e,n){if(""==s)return n("no query found");a.query(s+" LIMIT 1",u).then(function(t){s=null,u=[],0==t.rows.length?n("no result found"):e(t.rows.item(0))},function(e){n(e)})})}}]),angular.module("storelitedb").factory("DBUtil",function(){function e(e,n){localStorage.setItem(e,n)}function n(e){return localStorage.getItem(e)}return{prepareFields:function(e,n){var t={field:[],values:[]};for(var o in e)switch(t.values.push(e[o]),n){case"create":t.field.push(o+" "+e[o]);break;case"insert":t.field.push(o);break;case"update":t.field.push(o+" = ?")}return t},prepareConditions:function(e){var n={values:[],rules:[]};for(var t in e){var o="= ?";if("object"==typeof e[t])switch((o=e[t].operator).toLowerCase()){case"in":case"not in":case"between":value=e[t].value.map(function(e){return n.values.push(e),"?"}).join("between"==o.toLowerCase()?" AND ":","),o="between"==o.toLowerCase()?o+" "+value:o+"("+value+")";break;default:n.values.push(e[t].value),o+=" ?"}else n.values.push(e[t]);n.rules.push(t+" "+o)}return n},get:n,set:e,setObject:function(n,t){e(n,angular.toJson(t))},getObject:function(e){return angular.fromJson(n(e))}}});